<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import "dotenv/config";
import { Events } from "@nerimity/nerimity.js";
import client from "./client.js";
import { loadCommands } from "./utils/commandHandler.js";

/**
 * Stores all loaded commands from /commands.
 * Keys are command names, values are command objects.
 * @type {Map&lt;string, object>}
 */
let commands = new Map();

/**
 * MESSAGE HANDLER
 * Listens to messages and processes prefix-based commands.
 */
client.on(Events.MessageCreate, async (message) => {
  // Ignore empty messages or messages from the bot itself
  if (!message?.content) return;
  if (message.user?.id === client.user?.id) return;

  /**
   * PREFIX VALIDATION
   * The bot will only listen to messages starting with the configured prefix.
   */
  const prefix = process.env.PREFIX;
  if (!prefix) {
    console.error("PREFIX missing in .env");
    return;
  }

  if (!message.content.startsWith(prefix)) return;

  /**
   * COMMAND PARSING
   * Example:
   *   "!ping hello world"
   * > commandName = "ping"
   * > args = ["hello", "world"]
   */
  const content = message.content.slice(prefix.length).trim();
  if (!content) return;

  const args = content.split(/\s+/);
  const commandName = args.shift()?.toLowerCase();

  // Find command handler
  const command = commands.get(commandName);
  if (!command) return;

  /**
   * COMMAND EXECUTION
   * Each command file must export:
   * {
   *   name: "example",
   *   description: "what it does",
   *   async execute(message, args, client) {}
   * }
   */
  try {
    await command.execute(message, args, client);
  } catch (err) {
    console.error("Command execution error:", err);
    message.reply("âŒ There was an error executing that command.");
  }
});

/**
 * READY EVENT
 * Triggered when the bot logs in successfully.
 */
client.on(Events.Ready, async () => {
  console.log(
    `Logged in as ${client.user.username} | ${client.servers.cache.size} servers`
  );

  /**
   * LOAD COMMANDS
   * loadCommands() scans /commands and returns a Map of command objects.
   */
  commands = await loadCommands();
  client.commands = commands;

  /**
   * STATUS ROTATION
   * Bot cycles through activities every 15 seconds.
   * Add more objects to the array for more statuses.
   */
  const activities = [
    async () => ({ action: "Playing", name: "Nerimity" }),
  ];

  let index = 0;

  const rotateActivity = async () => {
    try {
      const activity = await activities[index % activities.length]();
      client.user.setActivity(activity);
      index++;
    } catch (err) {
      console.error("Failed to update activity:", err);
    }
  };

  rotateActivity();
  setInterval(rotateActivity, 15000);
});

/**
 * LOGIN
 * Uses the bot token from the .env file.
 */
client.login(process.env.BOT_TOKEN);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkCooldown">checkCooldown</a></li><li><a href="global.html#commands">commands</a></li><li><a href="global.html#fileCommandMap">fileCommandMap</a></li><li><a href="global.html#loadCommandFile">loadCommandFile</a></li><li><a href="global.html#loadCommands">loadCommands</a></li><li><a href="global.html#loadDir">loadDir</a></li><li><a href="global.html#logSummary">logSummary</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sat Dec 13 2025 02:55:31 GMT+1100 (Australian Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
